{% comment %}
  KITH-STYLE HERO SLIDER
  Full-width, manual navigation with chevron, dot animation
{% endcomment %}

<section id="KithHeroSlider" class="kith-hero">
  <div class="kith-hero__wrapper">
    {% for block in section.blocks %}
      {% assign collection = collections[block.settings.collection] %}
      {% unless collection and collection.featured_image %}
        {% continue %}
      {% endunless %}

      <a
        href="{{ collection.url }}"
        class="kith-slide{% if forloop.first %} is-active{% endif %}"
        aria-label="{{ block.settings.heading | default: collection.title | escape }}"
        style="background-image: url({{ collection.featured_image | image_url: width: 2400 }});"
        data-index="{{ forloop.index0 }}"
      >
        <div class="kith-slide__content">
          {% if block.settings.heading or block.settings.subheading %}
            {% if block.settings.heading %}
              <h2 class="kith-slide__heading">{{ block.settings.heading | escape }}</h2>
            {% endif %}
            {% if block.settings.subheading %}
              <p class="kith-slide__subheading">{{ block.settings.subheading | escape }}</p>
            {% endif %}
          {% endif %}
        </div>
      </a>

      {% comment %} per-slide CTA as a sibling so it can be shown only when the slide is active {% endcomment %}
      {% if block.settings.cta_text and block.settings.cta_url %}
        <a
          href="{{ block.settings.cta_url }}"
          class="kith-slide__cta"
          data-index="{{ forloop.index0 }}"
          {% if block.settings.cta_new_tab %}
            target="_blank" rel="noopener noreferrer"
          {% endif %}
        >
          {{- block.settings.cta_text | escape -}}
        </a>
      {% endif %}
    {% endfor %}

    <!-- Chevron Prev/Next -->
    <button class="kith-arrow kith-prev" aria-label="Previous slide">&#10094;</button>
    <button class="kith-arrow kith-next" aria-label="Next slide">&#10095;</button>
  </div>

  <!-- Dots -->
  <div class="kith-dots">
    {% for block in section.blocks %}
      <div
        class="kith-dot{% if forloop.first %} active{% endif %}"
        data-dot="{{ forloop.index0 }}"
        {% if forloop.first %}
          aria-current="true"
        {% endif %}
      >
        <span class="progress"></span>
      </div>
    {% endfor %}
  </div>
</section>

{% stylesheet %}
  .kith-hero {
    position: relative;
    width: 100vw;
    max-width: 100%;
    overflow: hidden;
  }

  .kith-hero__wrapper {
    position: relative;
    width: 100%;
    height: 100vh;
  }

  .kith-slide {
    position: absolute;
    inset: 0;
    display: block;
    background-size: cover;
    background-position: center;
    opacity: 0;
    transition: opacity 0.8s ease;
    cursor: pointer;
    text-decoration: none;
    z-index: 1;
    /* prevent invisible slides from catching clicks */
    pointer-events: none;
  }

  .kith-slide.is-active {
    opacity: 1;
    /* active slide should accept pointer events and sit above others */
    pointer-events: auto;
    z-index: 2;
  }

  /* Slide overlay (heading / subheading) */
  .kith-slide__content {
    position: absolute;
    left: 64px;
    bottom: 96px;
    max-width: 720px;
    color: #fff;
    text-shadow: 0 6px 20px rgba(0, 0, 0, 0.6);
    z-index: 3;
    pointer-events: none; /* allow the anchor itself to receive clicks */
  }

  .kith-slide__heading {
    font-size: 48px;
    margin: 0 0 8px 0;
    font-weight: 700;
    line-height: 1.05;
  }

  .kith-slide__subheading {
    font-size: 18px;
    margin: 0;
    opacity: 0.95;
  }

  /* Dots */
  .kith-dots {
    position: absolute;
    bottom: 32px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 10px;
    z-index: 20;
  }

  .kith-dot {
    width: 10px;
    height: 10px;
    background: rgba(255, 255, 255, 0.4);
    border-radius: 50%;
    position: relative;
    overflow: hidden;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .kith-dot.active {
    width: 28px;
    border-radius: 5px;
  }

  .kith-dot .progress {
    position: absolute;
    top: 0;
    left: 0;
    width: 0%;
    height: 100%;
    background: white;
    transition: width 0s linear;
  }

  /* Chevron */
  .kith-arrow {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    font-size: 28px;
    color: #fff;
    background: transparent;
    border: none;
    padding: 0;
    cursor: pointer;
    z-index: 10;
  }

  .kith-prev {
    left: 20px;
  }
  .kith-next {
    right: 20px;
  }

  .kith-arrow:hover {
    opacity: 0.9;
  }

  /* CTA (shows on the right for the active slide) */
  .kith-slide__cta {
    position: absolute;
    top: 50%;
    right: 64px;
    transform: translateY(-50%);
    background: rgba(255, 255, 255, 0.1);
    color: #fff;
    border: 1px solid rgba(255, 255, 255, 0.18);
    padding: 12px 18px;
    border-radius: 6px;
    text-decoration: none;
    z-index: 3;
    opacity: 0;
    pointer-events: none;
    transition: opacity 240ms ease, transform 240ms ease;
  }

  /* show CTA when the corresponding slide is active */
  .kith-slide.is-active + .kith-slide__cta {
    opacity: 1;
    pointer-events: auto;
    transform: translateY(-50%) translateX(0);
  }
{% endstylesheet %}

<script
  src="{{ 'kith-hero-slider.js' | asset_url }}"
  type="module"
  fetchpriority="low"
></script>

{% schema %}
{
  "name": "KITH Hero Slider",
  "settings": [],
  "blocks": [
    {
      "type": "slide",
      "name": "Slide",
      "settings": [
        {
          "type": "collection",
          "id": "collection",
          "label": "Collection"
        },
        {
          "type": "text",
          "id": "heading",
          "label": "Heading",
          "default": "Default Heading"
        },
        {
          "type": "textarea",
          "id": "subheading",
          "label": "Subheading",
          "default": "Default subheading"
        },
        {
          "type": "text",
          "id": "cta_text",
          "label": "CTA text",
          "default": "Shop collection"
        },
        {
          "type": "url",
          "id": "cta_url",
          "label": "CTA URL",
          "default": "/collections"
        },
        {
          "type": "checkbox",
          "id": "cta_new_tab",
          "label": "Open CTA in new tab",
          "default": false
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "KITH Hero Slider"
    }
  ]
}
{% endschema %}
